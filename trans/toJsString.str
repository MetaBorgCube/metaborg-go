module toJsString

imports 
	src-gen/signatures/-
	helpers
		
rules

	/*
	Strategies that transform Go AST directly to a Javascript string
	*/

	generate-js-string :
		(selected, position, ast, path, project-path) -> (filename, result)
		with
			filename := <guarantee-extension(|"js")> path;
			debug(!"Starting compilation to string...");
			result	 := <gen-js> ast;
			debug(!"Compilation to string finished!")

	gen-js : SourceFile(packageClause, imports, topLevelDecls) -> js
		where
			packageName := <package-name> packageClause;
			debug(!<concat-strings> ["Found source file for package '", packageName, "'"]);
			js := <concat-strings> <mapsep(gen-js|"\n")> topLevelDecls
	
	gen-js : FunctionDecl(
		FunctionName(name),
		Function(
			Signature(parameters, returnType),
			FunctionBody(block)
		)
	) -> $[function [name] {[js]}]
		where
			debug(!<concat-strings> ["Found function ", name]);
			js := <gen-js> block
			
	gen-js : Block(statementList) -> js
		where
			statements := <statements-from-list> statementList;
			js := <mapsep(gen-js|"\n")> statements
	
	gen-js : PrintLn() -> "console.log()"
	